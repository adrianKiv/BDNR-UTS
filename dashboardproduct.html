<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>Dashboard KivRyelle</title>

	<!-- Site favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="vendors/images/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="vendors/images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="vendors/images/favicon-16x16.png">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="vendors/styles/core.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/icon-font.min.css">
	<link rel="stylesheet" type="text/css" href="src/plugins/datatables/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="src/plugins/datatables/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="vendors/styles/style.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-119386393-1');
	</script>
    <style> .custom-btn { padding: 0.15rem 0.5rem; /* Adjust padding */ font-size: 0.6rem; /* Adjust font size */ } </style>
    <style> .modal-content { padding: 20px; } .product-image { width: 100px; /* Atur lebar gambar */ height: auto; /* Pastikan rasio tetap */ } </style>
</head>
<body>

	<div class="header">
		<div class="header-left">
			<div class="menu-icon dw dw-menu"></div>
			<div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>
			<div class="header-search">
				<form>
					<div class="form-group mb-0">
						<i class="dw dw-search2 search-icon"></i>
						<input type="text" class="form-control search-input" placeholder="Search Here">
						<!-- <div class="dropdown">
							<a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
								<i class="ion-arrow-down-c"></i>
							</a>
							<div class="dropdown-menu dropdown-menu-right">
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">From</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">To</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">Subject</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="text-right">
									<button class="btn btn-primary">Search</button>
								</div>
							</div>
						</div> -->
					</div>
				</form>
			</div>
		</div>
		<div class="header-right">
			
			<div class="user-info-dropdown">
				<div class="dropdown">
					<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
					  <span class="user-icon">
						<img src="vendors/images/photo1.jpg" alt="">
					  </span>
					  <span class="user-name" id="userName">Loading...</span>
					</a>
					<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
					  <a class="dropdown-item" id="profileLink" href="profile.html"><i class="dw dw-user1"></i> Profile</a>
					  <a class="dropdown-item" id="logoutButton" href="#"><i class="dw dw-logout"></i> Log Out</a>
					</div>
				  </div>
			</div>
			
		</div>
	</div>

	<div class="left-side-bar">
		<div class="brand-logo">
			<a href="">
				<!-- <img src="vendors/images/deskapp-logo-white.svg" alt="" class="light-logo">
				  -->
				<h1 style="color: white;"><span>Dashboard</span></h1>
			</a>
			<div class="close-sidebar" data-toggle="left-sidebar-close">
				<i class="ion-close-round"></i>
			</div>
		</div>
		<div class="menu-block customscroll">
			<div class="sidebar-menu">
				<ul id="accordion-menu">
					<li class="dropdown">
						<a href="dashboard.html" class="dropdown-toggle">
						  <span class="micon dw dw-house-1"></span><span class="mtext">Home</span>
						</a>
					  </li>
					  <li class="dropdown">
						<a href="" class="dropdown-toggle">
						  <span class="micon dw dw-library"></span><span class="mtext">Product</span>
						</a>
					  </li>
					  <li class="dropdown">
						<a href="dashboardpesanan.html" class="dropdown-toggle">
						  <span class="micon dw dw-edit2"></span><span class="mtext">Pesanan</span>
						</a>
					  </li>
				</ul>
			</div>
		</div>
	</div>
	<div class="mobile-menu-overlay"></div>

	<div class="main-container">
		<div class="pd-ltr-20">
			
			<!-- <div class="row">
				<div class="col-xl-3 mb-30">
					<div class="card-box height-100-p widget-style1">
						<div class="d-flex flex-wrap align-items-center">
							<div class="progress-data">
								<div id="chart"></div>
							</div>
							<div class="widget-data">
								<div class="h4 mb-0">2020</div>
								<div class="weight-600 font-14">Contact</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 mb-30">
					<div class="card-box height-100-p widget-style1">
						<div class="d-flex flex-wrap align-items-center">
							<div class="progress-data">
								<div id="chart2"></div>
							</div>
							<div class="widget-data">
								<div class="h4 mb-0">400</div>
								<div class="weight-600 font-14">Deals</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 mb-30">
					<div class="card-box height-100-p widget-style1">
						<div class="d-flex flex-wrap align-items-center">
							<div class="progress-data">
								<div id="chart3"></div>
							</div>
							<div class="widget-data">
								<div class="h4 mb-0">350</div>
								<div class="weight-600 font-14">Campaign</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 mb-30">
					<div class="card-box height-100-p widget-style1">
						<div class="d-flex flex-wrap align-items-center">
							<div class="progress-data">
								<div id="chart4"></div>
							</div>
							<div class="widget-data">
								<div class="h4 mb-0">$6060</div>
								<div class="weight-600 font-14">Worth</div>
							</div>
						</div>
					</div>
				</div>
			</div> -->
			<!-- <div class="row">
				<div class="col-xl-8 mb-30">
					<div class="card-box height-100-p pd-20">
						<h2 class="h4 mb-20">Activity</h2>
						<div id="chart5"></div>
					</div>
				</div>
				<div class="col-xl-4 mb-30">
					<div class="card-box height-100-p pd-20">
						<h2 class="h4 mb-20">Lead Target</h2>
						<div id="chart6"></div>
					</div>
				</div>
			</div> -->
            <div class="card-box mb-30">
                <h2 class="h4 pd-20">Tabel produk</h2>
                <table class="data-table table nowrap">
                  <thead>
                    <tr>
                      <th>Product Name</th>
                      <th>Description</th>
                      <th>Price</th>
                      <th>Category</th>
                      <th>Stock</th>
                      <th>Created At</th>
                      <th>Updated At</th>
                      <th>image</th>
                      <th class="datatable-nosort">Action</th>
                    </tr>
                  </thead>
                  <tbody id="product-table-body">
                    <!-- Data akan diisi secara dinamis dengan JavaScript -->
                  </tbody>
                </table>
              
		</div>
	</div>
	<!-- js -->
	<script src="vendors/scripts/core.js"></script>
	<script src="vendors/scripts/script.min.js"></script>
	<script src="vendors/scripts/process.js"></script>
	<script src="vendors/scripts/layout-settings.js"></script>
	<script src="src/plugins/apexcharts/apexcharts.min.js"></script>
	<script src="src/plugins/datatables/js/jquery.dataTables.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
	<script src="src/plugins/datatables/js/dataTables.responsive.min.js"></script>
	<script src="src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
	<script src="vendors/scripts/dashboard.js"></script>
</body>
</html>
<script src="js/auth.js"></script>
<script>
	document.addEventListener("DOMContentLoaded", async () => {
	  // Check if the user is authenticated
	  const token = localStorage.getItem("authToken");
	
	  if (!token) {
		console.log("No token found. Redirecting to login page...");
		window.location.href = "login.html";
		return;
	  }
	
	  try {
		// Validate the token with the backend
		const response = await fetch("public/validate_token.php", {
		  method: "POST",
		  headers: {
			"Content-Type": "application/json",
			Authorization: `Bearer ${token}`,
		  },
		});
	
		const data = await response.json();
	
		if (!data.success) {
		  console.log("Invalid token. Redirecting to login page...");
		  localStorage.removeItem("authToken"); // Remove invalid token
		  window.location.href = "login.html";
		  return;
		}
	
		console.log("User is authenticated.");
	
		// Extract userId from the response or URL
		const urlParams = new URLSearchParams(window.location.search);
		const userId = urlParams.get("userId") || data.user.userId;
	
		// Fetch user data and update UI
		if (userId) {
		  fetchUserData(userId);
	
		  // Update links with userId
		  updateLinksWithUserId(userId);
		}
	  } catch (error) {
		console.error("Error validating token:", error);
		localStorage.removeItem("authToken");
		window.location.href = "login.html";
	  }
	
	  // Attach logout functionality
	  const logoutButton = document.getElementById("logoutButton");
	  if (logoutButton) {
		logoutButton.addEventListener("click", () => {
		  localStorage.removeItem("authToken");
		  console.log("User logged out. Redirecting to login page...");
		  window.location.href = "login.html";
		});
	  }
	});
	
	function updateLinksWithUserId(userId) {
	  // Update Product link
	  const productLink = document.querySelector('a[href="dashboard.html"]');
	  if (productLink) {
		productLink.href = `dashboard.html?userId=${userId}`;
	  }
	
	  // Update Pesanan link
	  const pesananLink = document.querySelector('a[href="dashboardpesanan.html"]');
	  if (pesananLink) {
		pesananLink.href = `dashboardpesanan.html?userId=${userId}`;
	  }
	
	  // Add userId to profile link
	  const profileLink = document.getElementById("profileLink");
	  if (profileLink) {
		profileLink.href = `profile.html?userId=${userId}`;
	  }
	}
	
	function fetchUserData(userId) {
	  // Make a GET request to the PHP file
	  fetch(`public/get_user.php?userId=${userId}`)
		.then((response) => response.json()) // Parse JSON response
		.then((data) => {
		  if (data.error) {
			console.error(data.error);
		  } else {
			// Update user name
			const userNameElement = document.getElementById("userName");
			if (userNameElement) {
			  userNameElement.textContent = data.username || "User";
			}
		  }
		})
		.catch((error) => {
		  console.error("An error occurred while fetching user data:", error);
		});
	}
	</script>
<script>

</script>

<script>
	const apiEndpoint = 'public/products.php'; // Ganti dengan URL API Anda
  
	// Fungsi untuk mengambil data produk dari API
	async function fetchProducts() {
	  try {
		const response = await fetch(apiEndpoint);
		const products = await response.json();
  
		if (!Array.isArray(products)) {
		  console.error("Invalid data format received:", products);
		  return;
		}
  
		populateProductTable(products);
	  } catch (error) {
		console.error("Error fetching product data:", error);
	  }
	}
  
	// Fungsi untuk mengisi tabel dengan data produk
	function populateProductTable(products) {
	  const tbody = document.getElementById("product-table-body");
	  tbody.innerHTML = ""; // Kosongkan tabel sebelum mengisi ulang
  
	  products.forEach(product => {
		const row = document.createElement("tr");
  
		// Nama Produk
		const nameCell = document.createElement("td");
		nameCell.textContent = product.name || "No name available";
		row.appendChild(nameCell);
  
		// Deskripsi
		const descriptionCell = document.createElement("td");
		descriptionCell.textContent = product.description || "No description available";
		row.appendChild(descriptionCell);
  
		// Harga
		const priceCell = document.createElement("td");
		priceCell.textContent = `$${(product.price || 0).toFixed(2)}`;
		row.appendChild(priceCell);
  
		// Kategori
		const categoryCell = document.createElement("td");
		categoryCell.textContent = product.category || "No category";
		row.appendChild(categoryCell);
  
		// Stok
		const stockCell = document.createElement("td");
		stockCell.textContent = product.stock || 0;
		row.appendChild(stockCell);
  
		// Tanggal Dibuat
		const createdAtCell = document.createElement("td");
		createdAtCell.textContent = product.createdAt || "N/A";
		row.appendChild(createdAtCell);
  
		// Tanggal Diperbarui
		const updatedAtCell = document.createElement("td");
		updatedAtCell.textContent = product.updatedAt || "N/A";
		row.appendChild(updatedAtCell);
  
		// Gambar
		const imageCell = document.createElement("td");
		if (product.images && product.images.length > 0) {
		  const img = document.createElement("img");
		  img.src = product.images[0];
		  img.alt = product.name;
		  img.classList.add("product-image");
		  imageCell.appendChild(img);
		} else {
		  imageCell.textContent = "No image available";
		}
		row.appendChild(imageCell);
  
		// Aksi (Update dan Delete)
		const actionCell = document.createElement("td");
		const updateButton = document.createElement("button");
		updateButton.classList.add("btn", "btn-warning", "custom-btn", "mr-2");
		updateButton.textContent = "Update";
		updateButton.addEventListener("click", () => updateProduct(product.id));
		actionCell.appendChild(updateButton);
  
		const deleteButton = document.createElement("button");
		deleteButton.classList.add("btn", "btn-danger", "custom-btn");
		deleteButton.textContent = "Delete";
		deleteButton.addEventListener("click", () => deleteProduct(product.id));
		actionCell.appendChild(deleteButton);
  
		row.appendChild(actionCell);
  
		tbody.appendChild(row);
	  });
	}
  
	// Fungsi Update Produk
	function updateProduct(productId) {
	  console.log("Update product with ID:", productId);
	  // Implementasikan logika update di sini
	}
  
	// Fungsi Delete Produk
	function deleteProduct(productId) {
	  console.log("Delete product with ID:", productId);
	  // Implementasikan logika delete di sini
	}
  
	// Jalankan fetchProducts saat halaman dimuat
	document.addEventListener("DOMContentLoaded", fetchProducts);
  </script>
  

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>