<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet" />
    <link href="css/tiny-slider.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <title>KivRyelle Store</title>
  </head>

  <body>
    <!-- Start Header/Navigation -->
    <nav
      class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark"
      arial-label="Furni navigation bar">
      <div class="container">
        <a class="navbar-brand" href="index.html">KivRyelle<span>.</span></a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarsFurni"
          aria-controls="navbarsFurni"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsFurni">
          <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="active">
              <a class="nav-link" href="shop.html">Shop</a>
            </li>
          </ul>

          <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
            <li>
              <a class="nav-link" href="profile.html"
                ><img src="images/user.svg"
              /></a>
            </li>
            <li>
              <a class="nav-link" href="cart.html"
                ><img src="images/cart.svg"
              /></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Header/Navigation -->

    <!-- Start Hero Section -->
    <div class="hero">
		<div class="container">
		  <div class="row justify-content-between">
			<div class="col-lg-5">
			  <div class="intro-excerpt">
				<h1>Shop</h1>
				<div class="search-filter mt-3 d-flex align-items-center">
				  <!-- Search Bar -->
				  <input
					type="text"
					id="searchInput" 
					class="form-control me-2"
					placeholder="Cari produk..."
					aria-label="Search"
				  />
				</div>
			  </div>
			</div>
			<div class="col-lg-7">
			  <!-- Empty column for layout or other content -->
			</div>
		  </div>
		</div>
	  </div>
	  
    <!-- End Hero Section -->

    <!-- HTML -->
    <br />
    <div class="container">
      <select class="form-select me-2 small-select" id="categorySelect">
        <option value="all" selected>Pilih Kategori</option>
        <option value="Handphone">HandPhone</option>
        <option value="Laptop">Laptop</option>
        <option value="Smart Watch">SmartWatch</option>
        <option value="Headset & friends">Headset</option>
        <option value="Mouse">Mouse</option>
        <option value="Monitor">Monitor</option>
        <option value="Keyboard">Keyboard</option>
        <option value="Charger">Charger</option>
        <option value="Disk">Disk</option>
      </select>
    </div>

    <div class="untree_co-section product-section before-footer-section">
      <div class="container">
        <div class="row" id="productContainer">
          <!-- Produk akan ditambahkan di sini berdasarkan kategori -->
        </div>
      </div>
    </div>

    <!-- Start Footer Section -->
    <footer class="footer-section">
      <div class="container relative">
        <div class="sofa-img">
          <img src="images/setpc.png" alt="Image" class="img-fluid" />
        </div>

        <div class="row">
          <div class="col-lg-8">
            <div class="subscription-form">
              <h3 class="d-flex align-items-center">
                <span class="me-1"
                  ><img
                    src="images/envelope-outline.svg"
                    alt="Image"
                    class="img-fluid" /></span
                ><span>Subscribe to Danpis</span>
              </h3>

              <form action="#" class="row g-3">
                <div class="col-auto">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Enter your name" />
                </div>
                <div class="col-auto">
                  <input
                    type="email"
                    class="form-control"
                    placeholder="Enter your email" />
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary">
                    <span class="fa fa-paper-plane"></span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="row g-5 mb-5">
          <div class="col-lg-4">
            <div class="mb-4 footer-logo-wrap">
              <a href="#" class="footer-logo">Keep Real<span>.</span></a>
            </div>
            <p class="mb-4">
              Us on Media Social :
            </p>

            <ul class="list-unstyled custom-social">
              <li>
                <a href="#"><span class="fa fa-brands fa-facebook-f"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-twitter"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-instagram"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-linkedin"></span></a>
              </li>
            </ul>
          </div>
        </div>

        <div class="border-top copyright">
          <div class="row pt-4">
            <div class="col-lg-6">
              <p class="mb-2 text-center text-lg-start">
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script>
                . All Rights Reserved. &mdash; Designed with Expert by kelompok 12
                <!-- License information: https://untree.co/license/ -->
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer Section -->

    <script src="js/auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // Check if the user is authenticated
        const token = localStorage.getItem("authToken");

        if (!token) {
          console.log("No token found. Redirecting to login page...");
          window.location.href = "login.html";
          return;
        }

        try {
          // Validate the token with the backend
          const response = await fetch("public/validate_token.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
          });

          const data = await response.json();
		  
          if (!data.success) {
            console.log("Invalid token. Redirecting to login page...");
            localStorage.removeItem("authToken"); // Remove invalid token
            window.location.href = "login.html";
            return;
          }
          
          console.log("User is authenticated.");
        } catch (error) {
          console.error("Error validating token:", error);
          localStorage.removeItem("authToken");
          window.location.href = "login.html";
        }

        
      });
    </script>
    <script>
		// Retrieve the userId from the current page's URL
		const urlParams = new URLSearchParams(window.location.search);
		const userId = urlParams.get('userId'); // Assuming userId is passed as a parameter
	
		// If userId exists, append it to the relevant links
		if (userId) {
			// Update the Home link
			document.querySelector('a.nav-link[href="index.html"]').href = `index.html?userId=${userId}`;
	
			// Update the Shop link
			document.querySelector('a.nav-link[href="shop.html"]').href = `shop.html?userId=${userId}`;
	
			// Update the Profile link
			document.querySelector('a.nav-link[href="profile.html"]').href = `profile.html?userId=${userId}`;
	
			// Update the Cart link
			document.querySelector('a.nav-link[href="cart.html"]').href = `cart.html?userId=${userId}`;
		}

      // Function to fetch and display products
async function fetchAndDisplayProducts(category = "all", searchQuery = "") {
	try {
	  const response = await fetch("public/products.php");
	  const products = await response.json();
  
	  const container = document.getElementById("productContainer");
	  container.innerHTML = ""; // Clear container before adding new products
  
	  // Filter products by category
	  const filteredProducts = products.filter((product) => {
		// Check category and search query match
		const matchesCategory = category === "all" || product.category === category;
		const matchesSearch =
		  searchQuery === "" ||
		  product.name.toLowerCase().includes(searchQuery.toLowerCase());
  
		return matchesCategory && matchesSearch;
	  });
  
	  // Display filtered products
	  filteredProducts.forEach(async (product) => {
		
		const productDiv = document.createElement("div");
		productDiv.className = "col-12 col-md-4 col-lg-3 mb-5";
  
		productDiv.innerHTML = `
		  <a class="product-item" href="product_detail.php?id=${product.id}&userId=${userId}">
			<img src="${product.images[0]}" class="img-fluid product-thumbnail" />
			<h3 class="product-title">${product.name}</h3>
			<strong class="product-price">${product.price.toLocaleString("en-US", {
			  style: "currency",
			  currency: "USD",
			})}</strong>
			<span class="icon-cross">Detail</span>
		  </a>
		`;
		container.appendChild(productDiv);
	  });
	} catch (error) {
	  console.error("Failed to fetch product data:", error);
	}
  }
  
  // Add event listener for search input
  document.getElementById("searchInput").addEventListener("input", (event) => {
	const searchQuery = event.target.value;
	fetchAndDisplayProducts("all", searchQuery); // Display products matching the search query
  });
  
  // Category selection listener (if you have a category dropdown)
  document.getElementById("categorySelect").addEventListener("change", function () {
	const selectedCategory = this.value;
	const searchQuery = document.getElementById("searchInput").value; // Get current search query
	fetchAndDisplayProducts(selectedCategory, searchQuery);
  });
  
  // Load all products on page load
  window.onload = () => fetchAndDisplayProducts("all");
  
    </script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/custom.js"></script>
  </body>
</html>
